## Master's thesis
# Processing of medical histological data by deep neural network methods

This thesis aimed to address the complex task of Perineural invasion (PNI) segmentation by its decomposition into multiple subtasks. Each subtasks was handled by dedicated neural network model, each tailored to a specific purpose, such as tumor classification, nerve segmentation, and ultimately, PNI segmentation. This final step leveraged the predictions generated by the preceding models.

## Preprocessing
Initially, the image annotations in XML format needed to be converted into image data in TIF format. To achieve this, we utilized a slightly modified script provided by the _PAIP2021_ organization during their challenge. This script is located in the `mask_extraction` folder. Given the extremely high resolution (~1 gigapixel) of the provided histological images in SVS format, we opted for a sliding window method to divide these images into smaller 1024x1024 px patches, along with their corresponding mask patches. The source code for this patch extraction process is located in the `preprocessing` folder.

## Tumor classification
For the tumor classification of the smaller patches the ResNet-50 pretrained on Imagenet dataset was used. The input of this network was 512x512x3 px image patch (resized from 1024x1024x3 px) and the output was the probability of tumor.
For tumor classification of the smaller patches, we employed a ResNet-50 model pretrained on the ImageNet dataset. The input to this network was a 512x512x3 image patch (resized from the original 1024x1024x3). The output of the network was the probability of the presence of a tumor.

## Nerve segmentation
For nerve segmentation, we compared the performance of VGG-19 and ResNet-50 models, with ResNet-50 yielding better results. The input to the network was a 512x512x3 px image patch, and the output was a 512x512x1 segmentation mask of the nerves.

## PNI segmentation
For PNI segmentation, we utilized a modified ResNet-50 model with 2 inputs. The first input was a 512x512x4 image, where the first 3 channels represented the image patch and the 4th channel contained the nerve segmentation mask. The second input was the probability of tumor presence, which was directly connected to the final `Conditional Interpolation Layer`. Initially, the model generated predictions of the PNI curves, which were then interpolated with the tumor probability predictions in the `Conditional Interpolation Layer` to reduce false positive predictions.

![image](https://github.com/semjacko/master_thesis/assets/43437335/41142794-74d8-4437-a5b6-36abd09ba531)
